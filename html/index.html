<!DOCTYPE HTML>
    
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="de" lang="de"> 

<head>
	<title></title>

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	
	<link rel="stylesheet/less" type="text/css" href="css/layout.less">
	<link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui-1.8.19.custom.css" media="all">
	
	<script src="js/lib/bootstrap-min.js"></script>
	<script src="js/lib/modernizr-2.5.3.js"></script>
	<script src="js/lib/jquery-1.7.2.min.js"></script>
	<script src="js/lib/jquery-ui-1.8.19.custom.min.js"></script>
	<script src="js/lib/jquery.mousewheel.min.js"></script>
	
	<script src="js/lib/underscore.js"></script>
	<script src="js/lib/json2.js"></script>
	<script src="js/lib/backbone.js"></script>
	<script src="js/lib/less-1.3.0.min.js"></script>
	
	<script src="js/model/Capabilities.js"></script>
	<script src="js/model/Video.js"></script>
	<script src="js/model/Library.js"></script>
	
	<script src="js/view/LibraryListView.js"></script>
	
	</head>

<body>


	<script> 
	
	$b([

		]);
		
	var library;
	var libraryListView;

	
	$(document).ready(function(){
	
		Capabilities.test();
		
		
		
		$(window).resize(initLayout);
		initLayout();
		addEventListeners();
		
		library = new Library();
		libraryListView = new LibraryListView({model : library, el: $("#libraryListView")});

		$("#libraryView").accordion({animated:"slide", fillSpace: true}).sortable( { axis:"y", handle:"h3"});
	});
	
	function initLayout(){
		console.log("initLayout");
		var totalHeight = $(window).height();
		var toolbarHeight = $("header").height() + $("#middle").height();
		
		$("#top").height( (totalHeight-toolbarHeight)*0.61);
		$("#bottom").height( (totalHeight-toolbarHeight)*0.39);
	}
	
	function addEventListeners(){
		var dropbox = $("#libraryView")[0];
		dropbox.addEventListener("dragenter", dragEnter, false);
		dropbox.addEventListener("dragexit", dragExit, false);
		dropbox.addEventListener("dragover", dragOver, false);
		dropbox.addEventListener("drop", drop, false);
		
		$("#videoView").bind("mousewheel", function(event, delta, deltaX, deltaY) {
		console.log(delta);
			$("#player").css("-moz-transform", "scale(" + delta * 0.1 + "," + delta * 0.1 + ")");
		});
	}
	
	/*https://developer.mozilla.org/En/DragDrop/Drag_and_Drop*/
	function dragEnter(e){
		e.stopPropagation();
		e.preventDefault();
	};
	
	function dragExit(e){
		e.stopPropagation();
		e.preventDefault();
	};
	
	function dragOver(e){
		e.stopPropagation();
		e.preventDefault();
	};
	
	function drop(e){
		
		e.stopPropagation();
		e.preventDefault();
 

		
		var files = e.dataTransfer.files;
		var file = files[0];
		
		//console.log(file);
		
		var reader = new FileReader();
		var player = document.getElementById("player");
		

		reader.onloadend = function(e){
							
			if(window.webkitURL){
				window.webkitURL.revokeObjectURL(player.src); // Clean up after yourself.
			}
			else if(window.URL){
				window.URL.revokeObjectURL(player.src); // Clean up after yourself.
			}			

		}
			
		var localUrl;
		
		if(window.webkitURL){
			localUrl = window.webkitURL.createObjectURL(file);
		}
		else if(window.URL){
			localUrl = window.URL.createObjectURL(file);
		}	
		
		//console.log(localUrl);
		
		player.addEventListener('loadedmetadata', function(e) {
			//console.log(e.target.duration);
			//console.log(e.target.playbackRate);
			//console.log(e);
		});
		
		player.src = localUrl;
		
		console.log(file);
		
		if(Capabilities.isVideoFormatSupported(file.type)){
			library.add({name:file.name, size: file.size, type: file.type})
		}
		


		};

	
	</script> 
	

	
	<div id="wrapper">
		
	<header class="ui-widget-header">
		
	</header>
			
		<div id="top">
			<div id="libraryView">
				<h3><a href="#">Video-Sources</a></h3>
				<div><ul id="libraryListView"></ul></div>
				<h3><a href="#">Audio-Sources</a></h3>
				<div></div>
				<h3><a href="#">Effects</a></h3>
				<div></div>
			</div>
			<div id="videoView"><video id="player" width="600" height="400" controls style="margin-top:30px;" draggable="true"></div>
		</div>
		
	<div id="middle"  class="ui-widget-header">
		
	</div>
		
		<div id="bottom">
			<div id="layerView"></div>
			<div id="timelineView"></div>
		</div>
	</div>


</body>
</html>